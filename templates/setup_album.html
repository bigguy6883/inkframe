{% extends "base.html" %}

{% block title %}Select Album - photos.local{% endblock %}

{% block content %}
<div class="setup-wizard">
    <div class="step-indicator">
        <span class="step complete">1. WiFi</span>
        <span class="step complete">2. Google</span>
        <span class="step active">3. Photos</span>
    </div>

    <h2>Select Album</h2>

    {% if cache_stats.count > 0 %}
    <div class="info-box">
        <p><strong>{{ cache_stats.count }}</strong> photos cached ({{ cache_stats.size_mb }} MB)</p>
        {% if current_album %}
        <p>Current album: <strong>{{ current_album }}</strong></p>
        {% endif %}
    </div>
    {% endif %}

    {% if albums %}
    <form method="POST" id="album-form">
        <input type="hidden" name="action" value="sync">

        <div class="album-list">
            {% for album in albums %}
            <label class="album-item {% if album == current_album %}selected{% endif %}">
                <input type="radio" name="album" value="{{ album }}"
                    {% if album == current_album %}checked{% endif %}>
                <span class="album-name">{{ album }}</span>
            </label>
            {% endfor %}
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-large" id="sync-btn">
                Sync Photos
            </button>
            {% if cache_stats.count > 0 %}
            <a href="{{ url_for('index') }}" class="btn btn-secondary">
                Skip - Use Existing
            </a>
            {% endif %}
        </div>
    </form>

    <p class="help-text">Select an album to sync. Photos will be downloaded to this device.</p>

    {% else %}
    <div class="warning-box">
        <p>No albums found in your Google Photos.</p>
        <p>Create an album in Google Photos, add some photos to it, then refresh this page.</p>
        <button class="btn btn-secondary" onclick="location.reload()">Refresh</button>
    </div>
    {% endif %}
</div>

<style>
.album-list {
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid #ddd;
    border-radius: 8px;
    margin: 1rem 0;
}

.album-item {
    display: flex;
    align-items: center;
    padding: 1rem;
    border-bottom: 1px solid #eee;
    cursor: pointer;
    transition: background 0.2s;
}

.album-item:last-child {
    border-bottom: none;
}

.album-item:hover {
    background: #f5f5f5;
}

.album-item.selected {
    background: #e3f2fd;
}

.album-item input[type="radio"] {
    margin-right: 1rem;
}

.album-name {
    font-weight: 500;
}

.form-actions {
    margin-top: 1.5rem;
    display: flex;
    gap: 1rem;
}

#sync-btn:disabled {
    opacity: 0.6;
    cursor: wait;
}
</style>

<script>
document.getElementById('album-form').addEventListener('submit', function(e) {
    const btn = document.getElementById('sync-btn');
    btn.disabled = true;
    btn.textContent = 'Syncing...';
});

// Highlight selected album
document.querySelectorAll('.album-item input').forEach(input => {
    input.addEventListener('change', function() {
        document.querySelectorAll('.album-item').forEach(item => {
            item.classList.remove('selected');
        });
        this.closest('.album-item').classList.add('selected');
    });
});
</script>
{% endblock %}
