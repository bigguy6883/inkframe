# Context Handoff - 2026-02-04

## Current Project / Plan
**photos.local** - Google Photos E-Ink Frame on Raspberry Pi (192.168.0.32)

A Flask web app that displays photos from Google Photos on a Pimoroni Inky Impression e-ink display. Features setup wizard, WiFi AP mode, and photo slideshow.

## Current Phase
**Google OAuth Setup** - Implementing authentication to Google Photos

## Work Completed This Session

1. **Deployed latest code** to photos.local device
   - Smart WiFi connectivity check on startup
   - Setup screen text overflow fixes

2. **Google OAuth exploration** - Tried multiple approaches:
   - Web redirect flow: Failed (`.local` domains not allowed as redirect URIs)
   - Device flow with Desktop app: Failed ("Invalid client type")
   - Device flow with TV/Limited Input client: Failed ("Invalid scope" - Photos API doesn't support device flow)

3. **Final solution implemented**: Token generation script approach
   - Created `get_token.py` - runs on user's computer, uses localhost redirect
   - Updated `setup_google.html` with instructions to run script and copy token
   - Added `/get_token.py` route to serve the script
   - Switched from Photos Picker API to Photos Library API (`photoslibrary.readonly` scope)

## Key Files

**On photos.local (192.168.0.32):**
- `/home/pi/photos/app.py` - Main Flask app
- `/home/pi/photos/google_photos.py` - Google Photos API integration
- `/home/pi/photos/get_token.py` - Token generation script for user's computer
- `/home/pi/photos/templates/setup_google.html` - Setup instructions page
- `/home/pi/photos/config/google_credentials.json` - OAuth credentials

**On this Pi (192.168.0.221):**
- `/home/pi/photos/` - Source repo (git, 2 commits ahead of origin)

## Decisions Made

1. **Use Photos Library API** instead of Picker API (Picker doesn't support required auth flows)
2. **Token generation on user's computer** - Only practical approach since Google Photos APIs require web OAuth with valid redirect URIs
3. **Desktop app OAuth client** with secret (client ID: `991269250992-l7832b4mpua33b7seb43tvm7q8gs1a3h`)

## OAuth Credentials Created

- **Web app**: `991269250992-605f0ouv0mmg8761lte4fdhra0rfeli9` (not usable - redirect URI issue)
- **Desktop app**: `991269250992-l7832b4mpua33b7seb43tvm7q8gs1a3h` / `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` (IN USE)
- **TV client**: `991269250992-ljitdgeqolo01981nrtpqvt13jh47mnm` (no secret, not usable)

## Next Steps

1. **User needs to run token generation**:
   ```bash
   pip install google-auth-oauthlib
   curl -O http://photos.local/get_token.py
   python get_token.py
   scp token.json pi@photos.local:~/photos/config/
   ```

2. **After token is copied**: May need to update google_photos.py to use Library API endpoints instead of Picker API endpoints (current code still has Picker API functions)

3. **Enable Photos Library API** in Google Cloud Console if not already enabled

## Continuation Prompt

```
Resume from handoff: /home/pi/photos/.claude/handoffs/handoff-2026-02-04-2145.md
Context: photos.local Google Photos e-ink frame OAuth setup
Next: User needs to run get_token.py on their computer, then may need to update google_photos.py to use Library API instead of Picker API
```
